services:
  # KAAI Unified Service - All phases in one service
  # Cost: $7/month (single service) instead of $49/month (7 services)
  - type: web
    name: kaai-unified-platform
    env: node
    plan: starter
    rootDir: .
    buildCommand: |
      npm install && 
      cd phase1 && npm install && cd .. &&
      cd phase2 && npm install && npx playwright install chromium --with-deps && cd .. &&
      cd phase3 && npm install && cd .. &&
      cd phase4 && npm install && cd .. &&
      cd phase4.5 && npm install && cd .. &&
      cd phase5 && npm install && cd .. &&
      cd phase6 && npm install && cd ..
    startCommand: node unified-server.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: UNIFIED_MODE
        value: "true"
      - key: OPENAI_API_KEY
        sync: false
      - key: ANTHROPIC_API_KEY
        sync: false
      - key: PHASE1_MODEL
        value: claude-3-5-haiku-20241022
      - key: CHROMA_HOST
        value: localhost
      - key: CHROMA_PORT
        value: 8000
    healthCheckPath: /health
