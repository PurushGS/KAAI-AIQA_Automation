<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phase 1: NL ‚Üí Test Steps Converter</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .header {
      background: white;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .header h1 {
      font-size: 28px;
      color: #1f2937;
      margin-bottom: 10px;
    }
    
    .header .phase-badge {
      display: inline-block;
      background: #667eea;
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
    }
    
    .header p {
      margin-top: 10px;
      color: #6b7280;
    }
    
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    @media (max-width: 968px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }
    
    .card {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .card h2 {
      font-size: 20px;
      color: #1f2937;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e5e7eb;
    }
    
    textarea {
      width: 100%;
      min-height: 200px;
      padding: 15px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-family: inherit;
      font-size: 14px;
      resize: vertical;
      margin-bottom: 15px;
    }
    
    textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .btn {
      padding: 12px 24px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .btn:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-small {
      padding: 6px 12px;
      font-size: 14px;
    }
    
    .btn-danger {
      background: #ef4444;
    }
    
    .btn-danger:hover {
      background: #dc2626;
    }
    
    .btn-success {
      background: #10b981;
    }
    
    .btn-success:hover {
      background: #059669;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .step {
      background: #f9fafb;
      border-left: 4px solid #667eea;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      position: relative;
    }
    
    .step-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .step-title {
      font-weight: 600;
      color: #1f2937;
    }
    
    .step-actions {
      display: flex;
      gap: 5px;
    }
    
    .step-content {
      font-size: 14px;
      color: #6b7280;
      line-height: 1.6;
    }
    
    .step-field {
      margin: 5px 0;
    }
    
    .step-field strong {
      color: #374151;
      display: inline-block;
      min-width: 80px;
    }
    
    .step-field code {
      background: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: #667eea;
    }
    
    .alert {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .alert-error {
      background: #fee2e2;
      color: #991b1b;
      border-left: 4px solid #ef4444;
    }
    
    .alert-success {
      background: #d1fae5;
      color: #065f46;
      border-left: 4px solid #10b981;
    }
    
    .alert-info {
      background: #dbeafe;
      color: #1e40af;
      border-left: 4px solid #3b82f6;
    }
    
    .example {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }
    
    .example h3 {
      font-size: 14px;
      color: #374151;
      margin-bottom: 10px;
    }
    
    .example code {
      display: block;
      background: white;
      padding: 10px;
      border-radius: 4px;
      font-size: 13px;
      line-height: 1.6;
      color: #1f2937;
      white-space: pre-wrap;
    }
    
    .json-output {
      background: #1f2937;
      color: #e5e7eb;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .hidden {
      display: none;
    }
    
    /* Modal for editing steps */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 30px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e5e7eb;
    }
    
    .modal-header h3 {
      font-size: 20px;
      color: #1f2937;
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      color: #6b7280;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
    }
    
    .modal-close:hover {
      background: #f3f4f6;
      color: #1f2937;
    }
    
    .form-field {
      margin-bottom: 20px;
    }
    
    .form-field label {
      display: block;
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    .form-field input,
    .form-field select,
    .form-field textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
    }
    
    .form-field textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .form-field input:focus,
    .form-field select:focus,
    .form-field textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .form-field .hint {
      font-size: 12px;
      color: #6b7280;
      margin-top: 4px;
    }
    
    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 25px;
      padding-top: 20px;
      border-top: 1px solid #e5e7eb;
    }
    
    .btn-outline {
      background: white;
      color: #374151;
      border: 1px solid #d1d5db;
    }
    
    .btn-outline:hover {
      background: #f9fafb;
      border-color: #9ca3af;
      transform: none;
      box-shadow: none;
    }
  </style>
</head>
<body>
  <!-- Edit Step Modal -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>‚úèÔ∏è Edit Test Step</h3>
        <button class="modal-close" onclick="closeEditModal()">√ó</button>
      </div>
      
      <form id="editForm" onsubmit="saveStepEdit(event)">
        <div class="form-field">
          <label for="editDescription">Description *</label>
          <input type="text" id="editDescription" required placeholder="e.g., Navigate to login page">
          <div class="hint">Clear description of what this step does</div>
        </div>
        
        <div class="form-field">
          <label for="editAction">Action Type *</label>
          <select id="editAction" required onchange="updateFieldVisibility()">
            <option value="navigate">navigate - Go to a URL</option>
            <option value="click">click - Click an element</option>
            <option value="type">type - Enter text in a field</option>
            <option value="verify">verify - Check something exists/is visible</option>
            <option value="wait">wait - Wait for element to appear</option>
          </select>
          <div class="hint">The type of action to perform</div>
        </div>
        
        <div class="form-field" id="targetField">
          <label for="editTarget">Target *</label>
          <input type="text" id="editTarget" placeholder="e.g., https://example.com OR #email OR button.submit">
          <div class="hint">URL (for navigate) or element selector/description</div>
        </div>
        
        <div class="form-field" id="dataField">
          <label for="editData">Data</label>
          <input type="text" id="editData" placeholder="e.g., user@example.com">
          <div class="hint">Text to type (for type action)</div>
        </div>
        
        <div class="form-field" id="expectedField">
          <label for="editExpected">Expected Result</label>
          <input type="text" id="editExpected" placeholder="e.g., element visible OR text contains 'Welcome'">
          <div class="hint">What to verify (for verify action)</div>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn btn-outline" onclick="closeEditModal()">Cancel</button>
          <button type="submit" class="btn btn-success">Save Changes</button>
        </div>
      </form>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <span class="phase-badge">PHASE 1</span>
      <h1>üîÑ Natural Language ‚Üí Test Steps Converter</h1>
      <p>Test the AI-powered conversion of natural language test descriptions into structured, machine-readable test steps</p>
    </div>
    
    <div class="grid">
      <!-- Input Section -->
      <div class="card">
        <h2>üìù Input: Natural Language Test Description</h2>
        
        <textarea id="nlInput" placeholder="Example:
Test login functionality

Steps:
1. Navigate to https://example.com/login
2. Enter email: user@example.com
3. Enter password: password123
4. Click the submit button
5. Verify dashboard appears
6. Verify welcome message is visible"></textarea>
        
        <button class="btn" onclick="convert()" id="convertBtn">
          Convert to Test Steps
        </button>
        
        <div class="example">
          <h3>üí° Example Test Descriptions:</h3>
          <code>Test search feature:
1. Go to homepage
2. Type "laptop" in search box
3. Click search button
4. Verify results appear
5. Verify at least 5 results shown</code>
        </div>
      </div>
      
      <!-- Output Section -->
      <div class="card">
        <h2>‚öôÔ∏è Output: Structured Test Steps</h2>
        
        <div id="outputContainer">
          <div class="alert alert-info">
            Enter a test description and click "Convert to Test Steps" to see the structured output
          </div>
        </div>
        
        <div id="stepsContainer" class="hidden">
          <div id="stepsList"></div>
          
          <h3 style="margin-top: 20px; margin-bottom: 10px;">üìã JSON Export:</h3>
          <div class="json-output" id="jsonOutput"></div>
        </div>
      </div>
    </div>
    
    <div class="card" id="statsCard" class="hidden">
      <h2>üìä Conversion Statistics</h2>
      <div id="statsContent"></div>
    </div>
  </div>
  
  <script>
    let currentSteps = [];
    let editingStepNumber = null;
    
    /**
     * Update field visibility based on action type
     */
    function updateFieldVisibility() {
      const action = document.getElementById('editAction').value;
      const targetField = document.getElementById('targetField');
      const dataField = document.getElementById('dataField');
      const expectedField = document.getElementById('expectedField');
      const targetInput = document.getElementById('editTarget');
      
      // All actions need target
      targetField.style.display = 'block';
      
      // Update target hint based on action
      const targetHint = targetField.querySelector('.hint');
      if (action === 'navigate') {
        targetHint.textContent = 'Full URL (e.g., https://example.com/login)';
        targetInput.placeholder = 'https://example.com';
      } else {
        targetHint.textContent = 'CSS selector (e.g., #email, .btn-submit) or element description';
        targetInput.placeholder = '#elementId OR .className OR button text';
      }
      
      // Show/hide data field
      if (action === 'type') {
        dataField.style.display = 'block';
      } else {
        dataField.style.display = 'none';
        document.getElementById('editData').value = '';
      }
      
      // Show/hide expected field
      if (action === 'verify') {
        expectedField.style.display = 'block';
      } else {
        expectedField.style.display = 'none';
        document.getElementById('editExpected').value = '';
      }
    }
    
    /**
     * Open edit modal with step data
     */
    function openEditModal(stepNumber) {
      const step = currentSteps.find(s => s.stepNumber === stepNumber);
      if (!step) return;
      
      editingStepNumber = stepNumber;
      
      // Populate form
      document.getElementById('editDescription').value = step.description || '';
      document.getElementById('editAction').value = step.action || 'navigate';
      document.getElementById('editTarget').value = step.target || '';
      document.getElementById('editData').value = step.data || '';
      document.getElementById('editExpected').value = step.expected || '';
      
      // Update field visibility
      updateFieldVisibility();
      
      // Show modal
      document.getElementById('editModal').classList.add('active');
    }
    
    /**
     * Close edit modal
     */
    function closeEditModal() {
      document.getElementById('editModal').classList.remove('active');
      editingStepNumber = null;
      document.getElementById('editForm').reset();
    }
    
    /**
     * Save step edit
     */
    async function saveStepEdit(event) {
      event.preventDefault();
      
      if (editingStepNumber === null) return;
      
      // Get form values
      const updates = {
        description: document.getElementById('editDescription').value.trim(),
        action: document.getElementById('editAction').value,
        target: document.getElementById('editTarget').value.trim(),
        data: document.getElementById('editData').value.trim() || null,
        expected: document.getElementById('editExpected').value.trim() || null
      };
      
      // Call API to edit step
      await editStep(editingStepNumber, updates);
      
      // Close modal
      closeEditModal();
    }
    
    /**
     * Close modal on outside click
     */
    document.addEventListener('click', function(event) {
      const modal = document.getElementById('editModal');
      if (event.target === modal) {
        closeEditModal();
      }
    });
    
    /**
     * Convert natural language to test steps
     */
    async function convert() {
      const input = document.getElementById('nlInput').value.trim();
      
      if (!input) {
        showError('Please enter a test description');
        return;
      }
      
      const btn = document.getElementById('convertBtn');
      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span>Converting...';
      
      try {
        const response = await fetch('/api/convert', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ naturalLanguage: input })
        });
        
        const result = await response.json();
        
        if (result.success) {
          currentSteps = result.steps;
          displaySteps(result);
          showSuccess('‚úÖ Successfully converted to ' + result.steps.length + ' steps!');
        } else {
          showError('Conversion failed: ' + result.error);
        }
        
      } catch (error) {
        showError('Error: ' + error.message);
      } finally {
        btn.disabled = false;
        btn.innerHTML = 'Convert to Test Steps';
      }
    }
    
    /**
     * Display converted steps
     */
    function displaySteps(result) {
      const container = document.getElementById('stepsContainer');
      const stepsList = document.getElementById('stepsList');
      const jsonOutput = document.getElementById('jsonOutput');
      
      // Clear previous
      stepsList.innerHTML = '';
      
      // Display each step
      result.steps.forEach(step => {
        const stepDiv = document.createElement('div');
        stepDiv.className = 'step';
        stepDiv.innerHTML = `
          <div class="step-header">
            <span class="step-title">Step ${step.stepNumber}: ${step.description}</span>
            <div class="step-actions">
              <button class="btn btn-small" onclick="openEditModal(${step.stepNumber})">‚úèÔ∏è Edit</button>
              <button class="btn btn-small btn-danger" onclick="deleteStep(${step.stepNumber})">üóëÔ∏è Delete</button>
            </div>
          </div>
          <div class="step-content">
            <div class="step-field"><strong>Action:</strong> <code>${step.action}</code></div>
            ${step.target ? `<div class="step-field"><strong>Target:</strong> <code>${step.target}</code></div>` : ''}
            ${step.data ? `<div class="step-field"><strong>Data:</strong> <code>${step.data}</code></div>` : ''}
            ${step.expected ? `<div class="step-field"><strong>Expected:</strong> <code>${step.expected}</code></div>` : ''}
          </div>
        `;
        stepsList.appendChild(stepDiv);
      });
      
      // Show JSON
      jsonOutput.textContent = JSON.stringify(result.steps, null, 2);
      
      // Show container
      container.classList.remove('hidden');
      
      // Show stats
      showStats(result);
    }
    
    /**
     * Edit step via API
     */
    async function editStep(stepNumber, updates) {
      try {
        const response = await fetch('/api/edit-step', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            steps: currentSteps,
            stepNumber: stepNumber,
            updates: updates
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          currentSteps = result.steps;
          displaySteps({ steps: result.steps });
          showSuccess('‚úÖ Step updated successfully!');
        } else {
          showError('Edit failed: ' + result.error);
        }
        
      } catch (error) {
        showError('Error: ' + error.message);
      }
    }
    
    /**
     * Delete step
     */
    async function deleteStep(stepNumber) {
      if (!confirm(`Delete step ${stepNumber}?`)) return;
      
      try {
        const response = await fetch('/api/delete-step', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            steps: currentSteps,
            stepNumber: stepNumber
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          currentSteps = result.steps;
          displaySteps({ steps: result.steps });
          showSuccess('‚úÖ Step deleted successfully!');
        } else {
          showError('Delete failed: ' + result.error);
        }
        
      } catch (error) {
        showError('Error: ' + error.message);
      }
    }
    
    /**
     * Show statistics
     */
    function showStats(result) {
      const statsCard = document.getElementById('statsCard');
      const statsContent = document.getElementById('statsContent');
      
      const actionCounts = {};
      result.steps.forEach(step => {
        actionCounts[step.action] = (actionCounts[step.action] || 0) + 1;
      });
      
      statsContent.innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
          <div style="background: #f9fafb; padding: 15px; border-radius: 8px;">
            <div style="font-size: 32px; font-weight: bold; color: #667eea;">${result.steps.length}</div>
            <div style="font-size: 14px; color: #6b7280;">Total Steps</div>
          </div>
          ${Object.entries(actionCounts).map(([action, count]) => `
            <div style="background: #f9fafb; padding: 15px; border-radius: 8px;">
              <div style="font-size: 24px; font-weight: bold; color: #1f2937;">${count}</div>
              <div style="font-size: 14px; color: #6b7280;">${action}</div>
            </div>
          `).join('')}
        </div>
        <div style="margin-top: 15px; padding: 15px; background: #dbeafe; border-radius: 8px; color: #1e40af;">
          <strong>‚úÖ Ready for Phase 2:</strong> These structured steps can now be executed by the test runner
        </div>
      `;
      
      statsCard.classList.remove('hidden');
    }
    
    /**
     * Show error message
     */
    function showError(message) {
      const container = document.getElementById('outputContainer');
      container.innerHTML = `<div class="alert alert-error">${message}</div>`;
      document.getElementById('stepsContainer').classList.add('hidden');
    }
    
    /**
     * Show success message
     */
    function showSuccess(message) {
      const container = document.getElementById('outputContainer');
      container.innerHTML = `<div class="alert alert-success">${message}</div>`;
    }
  </script>
</body>
</html>

